{"version":3,"sources":["../../routes/index.js"],"names":["express","require","router","Router","ClientAccountRepository","clientAccountRepository","Authentication","authenticator","get","req","res","next","render","title","sess","session","email","login","query","pwd","then","result","redirect","getAccountByEmail","account","app_id","clientId","secret","post","createAccount","body","catch","error","console","log","module","exports"],"mappings":";;AAAA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACA,IAAIC,SAASF,QAAQG,MAAR,EAAb;AACA,IAAIC,0BAA0BH,QAAQ,uCAAR,CAA9B;AACA,IAAII,0BAA0B,IAAID,uBAAJ,EAA9B;AACA,IAAIE,iBAAiBL,QAAQ,gCAAR,CAArB;AACA,IAAIM,gBAAgB,IAAID,cAAJ,EAApB;;AAEAJ,OAAOM,GAAP,CAAW,QAAX,EAAqB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;;AAE1CD,QAAIE,MAAJ,CAAW,OAAX,EAAoB,EAAEC,OAAO,SAAT,EAApB;AAEH,CAJD;;AAMAX,OAAOM,GAAP,CAAW,SAAX,EAAsB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC3C,QAAIG,OAAOL,IAAIM,OAAf;AACAD,SAAKE,KAAL,GAAa,IAAb;AACAN,QAAIE,MAAJ,CAAW,OAAX,EAAoB,EAAEC,OAAO,SAAT,EAApB;AAEH,CALD;;AAQA;AACAX,OAAOM,GAAP,CAAW,eAAX,EAA4B,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AACnD,QAAIG,OAAOL,IAAIM,OAAf;AACER,kBAAcU,KAAd,CAAoBR,IAAIS,KAAJ,CAAUF,KAA9B,EAAoCP,IAAIS,KAAJ,CAAUC,GAA9C,EAAmDC,IAAnD,CAAwD,UAACC,MAAD,EAAW;AAChE,YAAGA,MAAH,EAAW;AACPP,iBAAKE,KAAL,GAAaP,IAAIS,KAAJ,CAAUF,KAAvB;AACAN,gBAAIY,QAAJ,CAAa,YAAb;AACH,SAHD,MAIK;AACDZ,gBAAIY,QAAJ,CAAa,QAAb;AACH;AACH,KARD;AAWH,CAbD;;AAeApB,OAAOM,GAAP,CAAW,YAAX,EAAyB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC9C,QAAIG,OAAOL,IAAIM,OAAf;AACA,QAAGD,KAAKE,KAAR,EAAe;AACXX,gCAAwBkB,iBAAxB,CAA0CT,KAAKE,KAA/C,EAAsDI,IAAtD,CAA2D,UAAUI,OAAV,EAAmB;AAC1Ed,gBAAIE,MAAJ,CAAW,WAAX,EAAwB,EAAEa,QAAQD,QAAQE,QAAlB,EAA4BC,QAAQH,QAAQG,MAA5C,EAAoDX,OAAMQ,QAAQR,KAAlE,EAAxB;AACC,SAFL;AAGH,KAJD,MAKK;AACDN,YAAIY,QAAJ,CAAa,QAAb;AACH;AAEJ,CAXD;;AAaApB,OAAOM,GAAP,CAAW,WAAX,EAAwB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;;AAE7CD,QAAIE,MAAJ,CAAW,UAAX,EAAsB,EAAtB;AAEH,CAJD;;AAMAV,OAAO0B,IAAP,CAAY,WAAZ,EAAyB,UAASnB,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;;AAGlD,QAAIU,SAAUhB,wBAAwBwB,aAAxB,CAAsCpB,IAAIqB,IAAJ,CAASd,KAA/C,EAAsDP,IAAIqB,IAAJ,CAASX,GAA/D,EACTY,KADS,CACH,UAACC,KAAD,EAAU;AAACC,gBAAQC,GAAR,CAAYF,KAAZ;AAAmB,KAD3B,CAAd;;AAGI,QAAG,CAACX,MAAJ,EACIX,IAAIE,MAAJ,CAAW,UAAX,EAAsB,EAACoB,OAAO,sBAAR,EAAtB,EADJ,KAGItB,IAAIY,QAAJ,CAAa,QAAb;AAEP,CAXD;;AAcAa,OAAOC,OAAP,GAAiBlC,MAAjB","file":"index.js","sourcesContent":["var express = require('express');\nvar router = express.Router();\nvar ClientAccountRepository = require('../Repository/ClientAccountRepository')\nvar clientAccountRepository = new ClientAccountRepository;\nvar Authentication = require('../authenticate/authentication')\nvar authenticator = new Authentication();\n\nrouter.get('/login', function(req, res, next) {\n\n    res.render('index', { title: 'Express' });\n\n});\n\nrouter.get('/logout', function(req, res, next) {\n    var sess = req.session\n    sess.email = null;\n    res.render('index', { title: 'Express' });\n\n});\n\n\n/* GET home page. */\nrouter.get('/authenticate', function(req, res, next) {\n  var sess = req.session\n    authenticator.login(req.query.email,req.query.pwd).then((result) =>{\n       if(result) {\n           sess.email = req.query.email;\n           res.redirect('/dashboard');\n       }\n       else {\n           res.redirect('/login');\n       }\n    });\n\n\n});\n\nrouter.get('/dashboard', function(req, res, next) {\n    var sess = req.session\n    if(sess.email ){\n        clientAccountRepository.getAccountByEmail(sess.email).then(function (account) {\n            res.render('dashboard', { app_id: account.clientId, secret: account.secret, email:account.email });\n            });\n    }\n    else {\n        res.redirect('/login');\n    }\n\n});\n\nrouter.get('/register', function(req, res, next) {\n\n    res.render('register',{});\n\n});\n\nrouter.post('/register', function(req, res, next) {\n\n\nvar result=   clientAccountRepository.createAccount(req.body.email, req.body.pwd)\n    .catch((error) =>{console.log(error)});\n\n    if(!result)\n        res.render('register',{error: 'Email already exists'});\n    else\n        res.redirect('/login');\n\n});\n\n\nmodule.exports = router;\n"]}